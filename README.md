# smux

socket multiplexing, 基于可靠连接（tcp）的多路复用。

基于 xtaci/smux 修改，解决某一个 stream 不读，但对端一直写导致 tcp 缓冲区被写满，进而堵塞其他的 stream 。

## introduce

由于通信链路只有一条，而有多条虚拟链路。需保证通信链路畅通，不被任意 stream 堵塞。

在 stream 端设置读写缓冲区，stream 间的数据投递采用响应式，响应结果中带上对端读缓冲区的剩余容量。
本端根据对端容量封包数据长度，知道对端剩余容量为0，不再发送数据。

当对端从读缓冲区读出数据后，通告剩余容量大小，对端继续发送数据。

通信链路的 buffer 大小固定为 64k。
stream 的读写缓冲区大小固定为 521k。

    
## 优化

请求响应式效率太低。

1. 设置可发送大小，为 stream 的读缓冲大小。
2. 本端一直发送数据直到可发送大小为0，暂停发送。
3. 重置可发送长度大小，请求对端的可用缓冲大小。若大小为0。此流程结束。
4. 应用层读取数据后，通告对端修改容量。（需等到对端重置协议后生效）